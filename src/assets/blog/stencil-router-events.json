{"title":"StencilJS Route Change events - Without any dependencies","description":"How to detect route changes in StencilJS Router using the core StencilJS APIs. No dependencies.","date":"3 June, 2020 01:46","body":"<p>Hey Stencil user! Are you using the official <a href=\"https://github.com/ionic-team/stencil-router/wiki\">StencilJS Router</a> and can't find how to detect route change events? Don't worry, my friend! You will find all the answers here.</p>\n<p>So, is there an <code>onRouteChange</code> event somewhere? Or something like <code>router.subscribe</code>?</p>\n<p>Nope. Its much simpler. Much much simpler, but for some reason, its not documented in the official Wiki (As of the time of writing), resulting in people using the <a href=\"https://ionicframework.com/docs/api/router\"><code>ion-router</code></a> instead, where everything is very very well documented.</p>\n<p>I myself had to port an application from Stencil Router to Ion router just because of this very reason, and it was a total pain.</p>\n<p>But after some searching and experimenting, I figured it out (No not time travel, I ain't Tony Stark). And was staring me in the face. It was that simple.</p>\n<h2>Solution</h2>\n<p>So here's your typical Stencil component.</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #89DDFF\">import</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">Component</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">Prop</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">h</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">@stencil/core</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">;</span>\n\n<span style=\"color: #89DDFF\">@</span><span style=\"color: #82AAFF\">Component</span><span style=\"color: #FFFFFF\">(</span><span style=\"color: #89DDFF\">{</span>\n<span style=\"color: #FFFFFF\">  tag</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">my-first-component</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">,</span>\n<span style=\"color: #89DDFF\">}</span><span style=\"color: #FFFFFF\">)</span>\n<span style=\"color: #89DDFF\">export</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #C792EA\">class</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #FFCB6B\">MyComponent</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">{</span>\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #89DDFF\">@</span><span style=\"color: #82AAFF\">Prop</span><span style=\"color: #FFFFFF\">() </span><span style=\"color: #A6ACCD\">name</span><span style=\"color: #C792EA\">:</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #B2CCD6\">string</span><span style=\"color: #89DDFF\">;</span>\n\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #82AAFF\">render</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">{</span>\n<span style=\"color: #FFFFFF\">    </span><span style=\"color: #89DDFF\">return</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">p</span><span style=\"color: #89DDFF\">&gt;My name is {</span><span style=\"color: #FF5370\">this</span><span style=\"color: #89DDFF\">.name}&lt;/</span><span style=\"color: #F07178\">p</span><span style=\"color: #89DDFF\">&gt;;</span>\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #89DDFF\">}</span>\n<span style=\"color: #89DDFF\">}</span></code></pre>\n<p>This becomes</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #89DDFF\">import</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">Component</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">Prop</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">h</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">Watch</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">@stencil/core</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">;</span>\n<span style=\"color: #89DDFF\">import</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">LocationSegments</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">injectHistory</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">@stencil/router</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">;</span>\n\n<span style=\"color: #89DDFF\">@</span><span style=\"color: #82AAFF\">Component</span><span style=\"color: #FFFFFF\">(</span><span style=\"color: #89DDFF\">{</span>\n<span style=\"color: #FFFFFF\">  tag</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">my-first-component</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">,</span>\n<span style=\"color: #89DDFF\">}</span><span style=\"color: #FFFFFF\">)</span>\n<span style=\"color: #89DDFF\">export</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #C792EA\">class</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #FFCB6B\">MyComponent</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">{</span>\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #89DDFF\">@</span><span style=\"color: #82AAFF\">Prop</span><span style=\"color: #FFFFFF\">() </span><span style=\"color: #A6ACCD\">name</span><span style=\"color: #C792EA\">:</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #B2CCD6\">string</span><span style=\"color: #89DDFF\">;</span>\n\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #676E95\">/**</span>\n<span style=\"color: #676E95\">   * Remember, this should be `location only`</span>\n<span style=\"color: #676E95\">   */</span>\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #89DDFF\">@</span><span style=\"color: #82AAFF\">Prop</span><span style=\"color: #FFFFFF\">() </span><span style=\"color: #A6ACCD\">location</span><span style=\"color: #C792EA\">:</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #FFCB6B\">LocationSegments</span><span style=\"color: #89DDFF\">;</span>\n\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #676E95\">/**</span>\n<span style=\"color: #676E95\">   * Now watch for any changes to the location property</span>\n<span style=\"color: #676E95\">   */</span>\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #89DDFF\">@</span><span style=\"color: #82AAFF\">Watch</span><span style=\"color: #FFFFFF\">(</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">location</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFFFFF\">) </span><span style=\"color: #82AAFF\">onRouteChange</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FF5370\">newRoute</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #FF5370\">oldRoute</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">{</span>\n<span style=\"color: #89DDFF\">    </span><span style=\"color: #676E95\">// Do some epic shit</span>\n<span style=\"color: #89DDFF\">    </span><span style=\"color: #676E95\">// Like changing document title or</span>\n<span style=\"color: #89DDFF\">    </span><span style=\"color: #676E95\">// Route animations. Its your choice.</span>\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #89DDFF\">}</span>\n\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #82AAFF\">render</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">{</span>\n<span style=\"color: #FFFFFF\">    </span><span style=\"color: #89DDFF\">return</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">p</span><span style=\"color: #89DDFF\">&gt;My name is {</span><span style=\"color: #FF5370\">this</span><span style=\"color: #89DDFF\">.name}&lt;/</span><span style=\"color: #F07178\">p</span><span style=\"color: #89DDFF\">&gt;;</span>\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #89DDFF\">}</span>\n<span style=\"color: #89DDFF\">}</span></code></pre>\n<p><strong>STOP!! It will still not work.</strong></p>\n<p>Yup this code will still not work. Let me explain why:</p>\n<p>The important bit here is the <code>location</code> prop. Think about it. Its a <strong>Prop</strong>. You pass a value to it. But here, nothing really is passing any value to our component here. Stencil certainly ain't.</p>\n<p>So, the solution is to have <em>something</em> pass a value to the <code>location</code> prop. Notice the <code>injectHistory</code> method we have imporgted but not used anywhere. Now's the time to use it. Just add this line at the very end of your file</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #82AAFF\">injectHistory</span><span style=\"color: #FFFFFF\">(</span><span style=\"color: #A6ACCD\">MyComponent</span><span style=\"color: #FFFFFF\">)</span><span style=\"color: #89DDFF\">;</span></code></pre>\n<p><code>MyComponent</code> is the name of the class declared above.</p>\n<p>So the final code becomes:</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #89DDFF\">import</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">Component</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">Prop</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">h</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">Watch</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">@stencil/core</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">;</span>\n<span style=\"color: #89DDFF\">import</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">LocationSegments</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #A6ACCD\">injectHistory</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">@stencil/router</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">;</span>\n\n<span style=\"color: #89DDFF\">@</span><span style=\"color: #82AAFF\">Component</span><span style=\"color: #FFFFFF\">(</span><span style=\"color: #89DDFF\">{</span>\n<span style=\"color: #FFFFFF\">  tag</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">my-first-component</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">,</span>\n<span style=\"color: #89DDFF\">}</span><span style=\"color: #FFFFFF\">)</span>\n<span style=\"color: #89DDFF\">export</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #C792EA\">class</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #FFCB6B\">MyComponent</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">{</span>\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #89DDFF\">@</span><span style=\"color: #82AAFF\">Prop</span><span style=\"color: #FFFFFF\">() </span><span style=\"color: #A6ACCD\">name</span><span style=\"color: #C792EA\">:</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #B2CCD6\">string</span><span style=\"color: #89DDFF\">;</span>\n\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #676E95\">/**</span>\n<span style=\"color: #676E95\">   * Remember, this should be `location only`</span>\n<span style=\"color: #676E95\">   */</span>\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #89DDFF\">@</span><span style=\"color: #82AAFF\">Prop</span><span style=\"color: #FFFFFF\">() </span><span style=\"color: #A6ACCD\">location</span><span style=\"color: #C792EA\">:</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #FFCB6B\">LocationSegments</span><span style=\"color: #89DDFF\">;</span>\n\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #676E95\">/**</span>\n<span style=\"color: #676E95\">   * Now watch for any changes to the location property</span>\n<span style=\"color: #676E95\">   */</span>\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #89DDFF\">@</span><span style=\"color: #82AAFF\">Watch</span><span style=\"color: #FFFFFF\">(</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">location</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFFFFF\">) </span><span style=\"color: #82AAFF\">onRouteChange</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FF5370\">newRoute</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #FF5370\">oldRoute</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">{</span>\n<span style=\"color: #89DDFF\">    </span><span style=\"color: #676E95\">// Do some epic shit</span>\n<span style=\"color: #89DDFF\">    </span><span style=\"color: #676E95\">// Like changing document title or</span>\n<span style=\"color: #89DDFF\">    </span><span style=\"color: #676E95\">// Route animations. Its your choice.</span>\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #89DDFF\">}</span>\n\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #82AAFF\">render</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">{</span>\n<span style=\"color: #FFFFFF\">    </span><span style=\"color: #89DDFF\">return</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">p</span><span style=\"color: #89DDFF\">&gt;My name is {</span><span style=\"color: #FF5370\">this</span><span style=\"color: #89DDFF\">.name}&lt;/</span><span style=\"color: #F07178\">p</span><span style=\"color: #89DDFF\">&gt;;</span>\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #89DDFF\">}</span>\n\n<span style=\"color: #FFFFFF\">  </span><span style=\"color: #82AAFF\">injectHistory</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FF5370\">MyComponent</span><span style=\"color: #89DDFF\">);</span>\n<span style=\"color: #89DDFF\">}</span></code></pre>\n<p>Here. Hope it helps. If you still run into issues, just ping me on Twitter. The link is in the footer.</p>\n<p>Goodbye and Enjoy!</p>\n"}